(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};let t;e.d({},{Wk:()=>Q,zG:()=>V,r$:()=>$,cY:()=>Z,t3:()=>ee});const s=e=>{const t="abcdefghijklmnoprstuwvxyz0123456789";let s="";for(let i=0;i<e;i++)s+=t[Math.floor(Math.random()*t.length)];return s},i=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.z-e.z,2)),a=class{constructor(e,t){this.space_pos=e,this.name=t||s(8)}translate_pos(e,t){const s=e.x-t,i=Math.PI/7;return{x:Math.floor(Math.cos(i)*s+e.z*Math.cos(i)),y:Math.floor(-Math.sin(i)*s+e.z*Math.sin(i)+this.parent.canvas.height-e.y)}}translate_self(){this.screen_pos=this.translate_pos(this.space_pos,this.parent.renderer_xpos)}kill(e){for(let t=0;t<this.parent.scene_children[e].length;t++)this.parent.scene_children[e][t]==this&&this.parent.scene_children[e].splice(t,1)}calc_axes(){let e=this.parent.renderer_xpos,t=this.space_pos;return[this.translate_pos({x:t.x-400,y:t.y,z:t.z},e),this.translate_pos({x:t.x+400,y:t.y,z:t.z},e),this.translate_pos({x:t.x,y:t.y-400,z:t.z},e),this.translate_pos({x:t.x,y:t.y+400,z:t.z},e),this.translate_pos({x:t.x,y:t.y,z:t.z-400},e),this.translate_pos({x:t.x,y:t.y,z:t.z+400},e)]}draw_axes(e){const t=this.calc_axes();e.beginPath(),e.strokeStyle="#ff0000",e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.stroke(),e.beginPath(),e.strokeStyle="#00ff00",e.moveTo(t[2].x,t[2].y+100),e.lineTo(t[3].x,t[3].y-100),e.stroke(),e.beginPath(),e.strokeStyle="#0000ff",e.moveTo(t[4].x,t[4].y),e.lineTo(t[5].x,t[5].y),e.stroke()}draw(e){console.error("None draw method inherited;\nMost likely wrong Object instance created")}},n=class{constructor(e,...t){this.vessel=e,this.last_pos={x:0,y:0,z:0},this.last_moves=[{x:0,y:0,z:0},{x:0,y:0,z:0},{x:0,y:0,z:0}],this.desired_point=this.vessel.space_pos,this.bend=0,this.distance_from_player=0,this.capabilities=t,this.task=this.new_task(),this.accelerate=!1,this.aim=!0,this.align_height=!1,this.keep_distance=!1,this.last_shot=0,this.speed=1,this.max_speed=3,this.acceleration=1.1,this.kill_attempts=0}new_task(){if(1==this.capabilities.length)return this.capabilities[0];let e=this.capabilities[Math.floor(Math.random()*this.capabilities.length)];for(;e==this.task;)e=this.capabilities[Math.floor(Math.random()*this.capabilities.length)];return e}check_bend(){this.last_moves[1].z*this.last_moves[0].z<-5&&this.last_moves[0].z<0&&(this.vessel.texture=this.vessel.bend_texture,this.bend=10)}update_last_move(e){this.last_moves[2]=this.last_moves[1],this.last_moves[1]=this.last_moves[0],this.last_moves[0]=e}withdraw(){this.vessel.space_pos.x-196<t.space_pos.x&&(this.current_move.x+=196/(this.vessel.space_pos.x-t.space_pos.x))}adjust_height(){this.current_move.y=-Math.sign(this.vessel.space_pos.y-t.space_pos.y)}roam(){this.accelerate=!0,this.aim=!0;const e=()=>{this.desired_point={x:Math.floor(128*Math.random()+t.space_pos.x+64*this.distance_from_player),y:Math.floor(48*Math.random()),z:Math.floor(150*Math.random()-75)}};this.desired_point.x<this.vessel.parent.renderer_xpos&&e(),Math.sqrt(Math.pow(this.desired_point.x-this.vessel.space_pos.x,2)+Math.pow(this.desired_point.y-this.vessel.space_pos.y,2)+Math.pow(this.desired_point.z-this.vessel.space_pos.z,2))>50?this.move_to_point(this.desired_point):(this.speed=1,e())}kamikaze(){this.max_speed=3,this.accelerate=!0,this.aim=!1,this.vessel.space_pos.x<t.space_pos.x&&(this.aim=!0),Math.floor(this.vessel.space_pos.z/16)==Math.floor(t.space_pos.z/16)&&Math.floor(this.vessel.space_pos.y/1)==Math.floor(t.space_pos.y/1)||(this.desired_point={x:t.space_pos.x-30,y:t.space_pos.y,z:t.space_pos.z}),this.vessel.space_pos.x!=this.desired_point.x||this.vessel.space_pos.y!=this.desired_point.y||this.vessel.space_pos.z!=this.desired_point.z?this.move_to_point(this.desired_point):this.desired_point={x:t.space_pos.x-30,y:t.space_pos.y,z:t.space_pos.z}}mimic(){this.keep_distance=!0,this.align_height=!0,this.accelerate=!0,this.aim=!0,this.max_speed=2;let e={x:0,y:0,z:0},s=this.vessel.space_pos.z-t.space_pos.z;e.z=Math.floor(-s/20),this.current_move.z+=e.z}move_to_point(e){let t=this.vessel.space_pos;Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.z-t.z,2))<10&&"PERSON"!=this.vessel.name&&(this.accelerate=!1,this.speed=this.speed/this.acceleration);let s=[Math.floor(Math.sign(e.x-t.x)*this.speed),Math.floor(Math.sign(e.y-t.y)),Math.floor(Math.sign(e.z-t.z)*this.speed)];this.current_move.x+=s[0],this.current_move.y+=s[1],this.current_move.z+=s[2]}think(){switch(this.current_move={x:0,y:0,z:0},this.kill_attempts>8&&(this.task=this.new_task(),this.kill_attempts=0),this.bend>0?(this.bend-=1,0==this.bend&&(this.vessel.texture=this.vessel.normal_texture)):this.check_bend(),this.speed>this.max_speed&&(this.accelerate=!1,this.speed=this.max_speed),this.aim&&!t.dead&&(t.space_pos.z==this.vessel.space_pos.z&&(this.vessel.fire(),this.kill_attempts++,this.last_shot=Math.floor(Date.now()/1e3)),Math.floor(Date.now()/1e3)-this.last_shot>20&&(this.vessel.fire(),this.kill_attempts++,this.last_shot=Math.floor(Date.now()/1e3))),this.accelerate&&(this.speed*=this.acceleration),this.keep_distance&&this.withdraw(),this.align_height&&this.adjust_height(),this.task){case"reach":this.aim=!1,this.keep_distance=!1,this.move_to_point(this.desired_point);break;case"roam":this.roam();break;case"kamikaze":this.kamikaze();break;case"mimic":this.mimic()}this.vessel.move(this.current_move.x,this.current_move.y,this.current_move.z),this.update_last_move(this.current_move)}},o={player:new Image,player_shadow:new Image,player_projectile:new Image,enemy_green:new Image,enemy_bend_green:new Image,enemy_purple:new Image,enemy_bend_purple:new Image,enemy_violet:new Image,enemy_bend_violet:new Image,enemy_red:new Image,enemy_bend_red:new Image,enemy_yellow:new Image,enemy_bend_yellow:new Image,enemy_pink:new Image,enemy_bend_pink:new Image,enemy_shadow:new Image,enemy_projectile:new Image,explosion:new Image,explosion_shadow:new Image,cactus:new Image,desert_stones:new Image,desert_bunker:new Image,person_waiting:new Image,person_walking:new Image,rails:new Image,pole:new Image,pump:new Image,rail_end:new Image,bush:new Image,dirt:new Image,meadow_bunker:new Image,road:new Image,road_skew:new Image,ruin1:new Image,ruin2:new Image,wave:new Image,control_panel:new Image},r=new Audio("./assets/audio/main.mp3");r.volume=.2,r.addEventListener("canplaythrough",(e=>{r.play()}));for(const[e,t]of Object.entries(o))t.src="./assets/spritesheets/"+e+".png";class h extends a{constructor(e,t,i,a,n,o){super(e),this.name=n||"ENEMY"+s(4),o&&(this.bend_texture=o,this.normal_texture=t),this.texture=t,this.shadow_texture=i,this.projectile_texture=a,this.dead=!1,this.cooldown=0,this.animation_frame=0,this.murders=0}set_intelligence(...e){this.mind=new n(this,...e)}fire(e){if(0!=this.cooldown)return 0;let s=-10;e&&(s*=-1);let i={x:this.space_pos.x,y:this.space_pos.y,z:this.space_pos.z},a={x:t.space_pos.x,y:t.space_pos.y,z:t.space_pos.z};e&&(a.x+=500),this.parent.add_projectile(new p(i,this,this.projectile_texture,s,a)),this.cooldown=24}move_out(){this.mind.task="reach",this.mind.speed=3,this.mind.desired_point={x:this.space_pos.x-500,y:this.space_pos.y,z:this.space_pos.z+30*(2*Math.random()-1)}}move(e,t,s){this.space_pos={x:this.space_pos.x+e,y:this.space_pos.y+t,z:this.space_pos.z+s},t<0&&this.space_pos.y<1&&(this.space_pos.y=0),"PERSON"!=this.name&&this.collision_check(),this.translate_self()}collision_check(){let e=6;if(0==this.space_pos.y)for(let t of this.parent.killer_positions)if(t.x<this.space_pos.x+e&&t.x>this.space_pos.x-e&&t.z<this.space_pos.z+e&&t.z>this.space_pos.z-e){if("PROJECTILE"==this.name)return 0;"PLAYER"==this.name&&(this.dead=!0),this.kill(1),this.parent.add_entity(new l(this.space_pos,o.explosion,o.explosion_shadow,["",this.name]))}if("PLAYER"==this.name)return 0;e=12;for(let s of this.parent.scene_children[1])if(this.space_pos.x<s.space_pos.x+e&&this.space_pos.x>s.space_pos.x-e&&this.space_pos.y<s.space_pos.y+e&&this.space_pos.y>s.space_pos.y-e&&this.space_pos.z<s.space_pos.z+e&&this.space_pos.z>s.space_pos.z-e&&s.name!=this.name&&"EXPLOSION"!=s.name&&"PERSON"!=s.name){if(this.name.includes("ENEMY")&&s.name.includes("ENEMY"))return 0;if("PLAYER"==this.name&&this.dead||"PLAYER"==s.name&&s.dead)return 0;if(this instanceof p){if(this.shooter.name==s.name)return 0;"PLAYER"!=this.shooter.name&&this.shooter.move_out(),this.shooter.murders++}"PLAYER"!=s.name&&"PLAYER"!=this.name||(t.dead=!0),this.parent.add_entity(new l(s.space_pos,o.explosion,o.explosion_shadow,[s.name,this.name])),s.kill(1),this.kill(1),this.kill(2)}}draw(e){this.cooldown>0&&this.cooldown--,this.show_axes&&this.draw_axes(e),this.mind&&this.mind.think(),e.beginPath(),e.drawImage(this.texture,16*Math.floor(this.animation_frame),0,16,8,this.screen_pos.x-8,this.screen_pos.y-8,16,8),e.stroke(),this.animation_frame+=.15,"PLAYER"==this.name&&1==this.dead&&(this.animation_frame+=.6),this.animation_frame>this.texture.width/16&&(this.animation_frame=0)}draw_shadow(e){let t=0;this.shadow_texture.width>16&&(t=16*Math.floor(this.animation_frame)),e.beginPath(),e.drawImage(this.shadow_texture,t,0,16,8,this.screen_pos.x-8,this.screen_pos.y+this.space_pos.y-4,18,8),e.stroke()}}class p extends h{constructor(e,t,s,i,a){super(e,s,new Image,new Image),this.name="PROJECTILE",this.shooter=t,this.speed=i,this.time_to_live=128,this.destination=a,this.mv_vector={x:8*Math.sign(this.destination.x-this.space_pos.x),y:0,z:8*Math.sign(this.destination.z-this.space_pos.z)}}move(){this.time_to_live--,0==this.time_to_live&&this.kill(2),this.space_pos={x:this.space_pos.x+this.mv_vector.x*Z,y:this.space_pos.y+this.mv_vector.y,z:this.space_pos.z+this.mv_vector.z},this.collision_check(),this.translate_self()}}class l extends h{constructor(e,t,s,i){super(e,t,s,new Image),this.name="EXPLOSION",this.victims=i}draw(e){e.beginPath(),e.drawImage(this.texture,16*Math.floor(this.animation_frame),0,16,8,this.screen_pos.x-8,this.screen_pos.y-8,18,10),e.stroke(),this.animation_frame+=.4,this.animation_frame>this.texture.width/16&&this.kill(1)}}let c=0;const _={texture:o.cactus,texture_dimensions:{x:8,y:8},animated:!1,density:24},d={texture:o.bush,texture_dimensions:{x:8,y:8},animated:!1,density:24},m={texture:o.desert_stones,texture_dimensions:{x:8,y:512},animated:!1,density:32},x={texture:o.dirt,texture_dimensions:{x:8,y:512},animated:!1,density:128},u={texture:o.desert_bunker,texture_dimensions:{x:32,y:16},animated:!1,density:1},y={texture:o.meadow_bunker,texture_dimensions:{x:32,y:16},animated:!1,density:1},f=(e,t,s)=>{let i=new Array;c++,c>16&&(c=0);for(let e=0;e<C/m.texture_dimensions.x;e++){let t=10*Math.random(),a=new H({x:e*m.texture_dimensions.x,y:-100,z:t},m.texture,m.animated,m.texture_dimensions.x);a.parent=s,i.push(a),a=new H({x:e*m.texture_dimensions.x+2*C,y:-100,z:-m.texture_dimensions.y/2+t},m.texture,m.animated,m.texture_dimensions.x),a.parent=s,i.push(a)}for(let e=0;e<(t?_.density:64);e++){let e=new H({x:Math.floor(Math.random()*C),y:0,z:Math.floor(Math.random()*D*1.5)-D/1.25},_.texture,_.animated,_.texture_dimensions.x);(t&&Math.abs(e.space_pos.z)>20||!t)&&(s.killer_positions.push(e.space_pos),e.parent=s,i.push(e))}if(16==c&&0==Math.floor(1*Math.random())){let e=new F({x:Math.floor(Math.random()*C),y:0,z:Math.floor(Math.random()*D/2)-D/4},u.texture,u.texture_dimensions.x);(t&&Math.abs(e.space_pos.z)>20||!t)&&(e.parent=s,i.push(e))}if(0==Math.floor(3*Math.random())){let e=new H({x:Math.floor(Math.random()*C),y:0,z:Math.floor(Math.random()*D/2)-D/4},o.pump,!0,32);(t&&Math.abs(e.space_pos.z)>20||!t)&&(s.killer_positions.push(e.space_pos),e.parent=s,i.push(e))}if(t){let e=o.rails;for(let t=0;t<C/e.width;t++){let a=new H({x:t*e.width,y:0,z:0},e,!1,e.width);a.parent=s,i.push(a)}let t=new H({x:0,y:0,z:-20},o.pole,!1,o.pole.width);t.parent=s,i.push(t)}if(e){let e=new H({x:8,y:0,z:2},o.rail_end,!1,o.rail_end.width);e.parent=s,i.push(e)}return i};let w;const g=(e,t)=>{let s=new Array,i=null;if(c++,c>16&&(c=0),t){let t=new H({x:m.texture_dimensions.x,y:-100,z:0},x.texture,x.animated,x.texture_dimensions.x);t.parent=e,s.push(t);let i=new H({x:-2*m.texture_dimensions.x,y:-100,z:-m.texture_dimensions.y/2},x.texture,x.animated,x.texture_dimensions.x);i.parent=e,s.push(i)}w instanceof W&&(w.space_pos.x+=128,w.translate_self());for(let t=0;t<C/x.texture_dimensions.x;t++){let i=10*Math.random(),a=new H({x:t*m.texture_dimensions.x,y:-100,z:i},x.texture,x.animated,x.texture_dimensions.x);a.parent=e,s.push(a);let n=new H({x:t*m.texture_dimensions.x+2*C,y:-100,z:-m.texture_dimensions.y/2+i},x.texture,x.animated,x.texture_dimensions.x);n.parent=e,s.push(n)}if(0==Math.floor(3*Math.random())){let t=Math.floor(Math.random()*C/2)+30;i=t;let a=0==Math.floor(2*Math.random()-1)?1:-1,n=Math.floor(5*Math.random()+6);for(let i=1;i<C/4;i++){if(i==n&&0==Math.floor(4*Math.random())){let n=new H({x:t+2,y:0,z:8*(i+1)*a},0==Math.floor(2*Math.random())?o.ruin1:o.ruin2,!1,32);n.parent=e,s.push(n);break}let r=new H({x:t,y:0,z:8*i*a},o.road_skew,!1,16);r.parent=e,s.push(r)}}let a=o.road;for(let i=t?2:0;i<C/a.width;i++){let t=new H({x:i*a.width,y:0,z:0},a,!1,a.width);t.parent=e,s.push(t)}for(let t=0;t<_.density;t++){let t=new H({x:Math.floor(Math.random()*C),y:0,z:Math.floor(Math.random()*D*1.5)-D/1.25},d.texture,d.animated,d.texture_dimensions.x),a=Math.abs(t.space_pos.x-i);Math.abs(t.space_pos.z)>20&&a>20&&(e.killer_positions.push(t.space_pos),t.parent=e,s.push(t))}if(16==c&&0==Math.floor(1*Math.random())){let t=new F({x:Math.floor(Math.random()*C),y:0,z:Math.floor(Math.random()*D/2)-D/4},y.texture,y.texture_dimensions.x),a=Math.abs(t.space_pos.x-i);Math.abs(t.space_pos.z)>20&&a>20&&(t.parent=e,s.push(t))}if(t)for(let t=-D/2;t<D/4;t++){let i=new H({x:24,y:0,z:8*t},o.road_skew,!1,16);i.parent=e,s.push(i)}return s},v=document.getElementById("control-panel"),z=v.getContext("2d"),M=o.control_panel,k={isMobile:!1,orientation:"horizontal",rotations:{a:0,b:0,g:0},clicked:!1,starting_rotation:{a:0,b:0,g:0}},b=e=>{(0==k.starting_rotation.a&&0==k.starting_rotation.b||Math.abs(k.starting_rotation.a-k.rotations.a)>30||Math.abs(k.starting_rotation.b-k.rotations.b)>30||Math.abs(k.starting_rotation.g-k.rotations.g)>30)&&(k.starting_rotation={a:e.alpha,b:e.beta,g:e.gamma}),k.rotations={a:e.alpha,b:e.beta,g:e.gamma},console.log(k)};var I=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{h(i.next(e))}catch(e){n(e)}}function r(e){try{h(i.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}h((i=i.apply(e,t||[])).next())}))};let E=100,P=!0,A=5,T=0,R=0,S="rescue mission engaged",L=80;const O=(e,t)=>{S=e,L=t},Y=e=>{let t=[V[Math.floor(Math.random()*V.length)],V[Math.floor(Math.random()*V.length)]];O(e+" wave engaged",50);let s=new Array,i=0,a=new Array;switch(e){case"alpha":i=1,a=["roam"];break;case"beta":i=2,a=["roam"];break;case"gamma":i=3,a=["roam","kamikaze"];break;case"delta":i=4,a=["roam","kamikaze","mimic"];break;case"epsilon":i=5,a=["roam","kamikaze","mimic"]}for(let e=0;e<i;e++){let i=Math.floor(Math.random()*t.length),n=new h({x:$.space_pos.x+256,y:Math.floor(20*Math.random())+30,z:10*e-30},t[i][1],o.enemy_shadow,o.enemy_projectile,void 0,t[i][0]);n.set_intelligence(...a),n.mind.distance_from_player=Math.ceil(3/Math.ceil($.space_pos.x/5e3)),s.push(n)}ee.add_entity(...s)};let j="";document.onkeydown=e=>{if(!P)return 0;j.includes(e.code)||(j+=e.code,"Escape"==e.code&&K(),"Space"==e.code&&N())},document.onkeyup=e=>{j=j.replace(e.code,"")},window.onclick=()=>{console.log("hey"),k.isMobile&&N()};const N=()=>{try{document.body.requestFullscreen()}catch(e){console.log("element could not enter fullscreen")}r.play();let e=document.getElementById("start-screen");if(e){j="",e.remove(),ee.render(q);let t=()=>f(!1,!0,ee);ee.set_background("#552500",t),Q.style.imageRendering="pixelated"}},K=()=>{let e=document.getElementById("pause");if(null==e){r.pause(),ee.stop_render();let e=document.createElement("p");e.id="pause",e.innerHTML="PAUSED",document.body.append(e)}else r.play(),e.remove(),ee.render(q)},q=()=>{((e,t,s,i,a)=>{v.style.imageRendering="pixelated",z.drawImage(M,0,0),z.fillStyle="#ffffff",z.font="6px atari",z.fillText("Score",24,12),z.fillText(t+"",42-4*(t+"").length,20),z.fillText(s+"",300-4*(s+"").length,14),z.fillText(i+"",250,22),z.fillText(a.length-($.dead?0:1)+"",250,32);for(let e of a)e.x>-5&&e.x<40&&e.y>-13&&e.y<13&&z.fillRect(e.x+92,e.y+28,2,1);z.textAlign="center",z.fillText(e,160-.5*e.length,5),z.textAlign="start"})(S,500*T+600*$.murders,T,A,((e,t)=>{let s=new Array;for(let i of e){if("PERSON"==i.name)continue;let e={x:i.space_pos.x-t,y:i.space_pos.y,z:i.space_pos.z};e.x/=12,e.z/=8,s.push({x:e.x,y:e.z})}return s})(ee.scene_children[1],ee.renderer_xpos));let e=[0,0,0];if($.dead&&(E=(e=>{$.space_pos.y>10?$.move(0,-1,0):$.space_pos.y<10&&$.move(0,10-$.space_pos.y,0),j="";for(let e of ee.scene_children[1])e instanceof l&&("PLAYER"!=e.victims[0]&&"PLAYER"!=e.victims[1]||(e.space_pos=$.space_pos));switch(e){case 100:$.dead=!0,A-=1,P=!1;break;case 50:ee.add_entity($),$.texture=o.explosion_shadow;break;case 20:$.texture=o.player,P=!0;break;case 0:e=101,$.dead=!1}return e-1})(E)),k.isMobile&&(e=(()=>{if(!P)return[0,0,0];let e=Math.floor((k.starting_rotation.g-k.rotations.g)/5)-1,t=-Math.floor((k.starting_rotation.b-k.rotations.b)/5);e<-3&&(e=-3),e>3&&(e=3),t<-3&&(t=-3),t>3&&(t=3);let s=[0,e,t];return(Math.abs($.space_pos.z+s[2])>64||0==$.space_pos.y)&&(s[2]=0),($.space_pos.y+s[1]>48||$.space_pos.y+s[1]<0)&&(s[1]=0),k.clicked&&($.fire(!0),k.clicked=!1),s})()),0!=$.space_pos.y&&(j.includes("KeyD")&&$.space_pos.z<64?e[2]=4:j.includes("KeyA")&&$.space_pos.z>-64&&(e[2]=-4)),j.includes("KeyS")?$.space_pos.y>=0&&$.space_pos.y<48&&(e[1]=2):j.includes("KeyW")&&$.space_pos.y>0&&$.space_pos.y<=48&&(e[1]=-2),j.includes("Space")&&(j=j.replace("Space",""),$.fire(!0)),e[0]=Math.floor($.space_pos.y*Z/16),0==e[0]&&0==e[1]&&0==e[2]||($.move(e[0],e[1],e[2]),ee.move_rendering_space(e[0])),j.includes("KeyZ")&&(j.includes("KeyO")?(Q.width=1152,Q.height=690):j.includes("KeyI")&&(Q.width=384,Q.height=230)),$.space_pos.x>8e3&&$.space_pos.x<8e3+C&&0==R&&(ee.background_generation=()=>f(!0,!1,ee),R++),$.space_pos.x>8e3+C&&$.space_pos.x<8e3+2*C&&1==R&&(ee.background_generation=()=>f(!1,!1,ee),R++),$.space_pos.x>12e3+C&&$.space_pos.x<12e3+2*C&&2==R){let e=new X({x:ee.scene_children[0][ee.scene_children[0].length-1].space_pos.x,y:0,z:0},"#00651a",ee);ee.scene_children[0].push(e),ee.background_generation=()=>g(ee,!0),R++}if($.space_pos.x>12100+C&&$.space_pos.x<12100+2*C&&3==R&&(ee.background_generation=()=>g(ee,!1),R++),$.space_pos.x>12800+C&&$.space_pos.x<12800+2*C&&4==R&&(ee.background_color="#00651a",R++),$.space_pos.x>24e3+C&&$.space_pos.x<24e3+2*C&&5==R){let e=new X({x:ee.scene_children[0][ee.scene_children[0].length-1].space_pos.x,y:0,z:0},"#163cf5",ee);ee.scene_children[0].push(e),ee.background_generation=()=>(e=>{let t=new Array;for(let s=0;s<32;s++){let s=new G({x:Math.floor(Math.random()*C),y:0,z:Math.floor(Math.random()*D*2-D)},o.wave,Math.floor(32*Math.random()+8));s.parent=e,t.push(s)}return t})(ee),R++}$.space_pos.x>24700+C&&$.space_pos.x<24700+2*C&&6==R&&(ee.background_color="#163cf5"),L>0&&L--,0==L&&(S="");let t="beta";if($.space_pos.x>5e3&&(t="gamma"),$.space_pos.x>7500&&(t="delta"),$.space_pos.x>1e4&&(t="epsilon"),100==ee.total_loops&&Y("alpha"),ee.total_loops%1024==0&&(()=>{for(let e of ee.scene_children[1])e.name.includes("ENEMY")&&e.move_out()})(),ee.total_loops%1096==0&&Y(t),0==A){r.pause(),O("dead",100),ee.stop_render();let e=Q.getContext("2d");I(void 0,void 0,void 0,(function*(){yield B(100);for(let t=0;t<32;t++)yield B(10),e.fillStyle="#000000",e.fillRect(0,t*(Q.height/32),Q.width,Q.height/32);z.fillStyle="#000000",z.fillRect(0,0,1e3,1e3),yield B(200);let t="Your final score was "+(500*T+600*$.murders);document.getElementById("end").innerHTML="GAMEOVER<br/>"+t}))}};let B=e=>I(void 0,void 0,void 0,(function*(){return new Promise((t=>{setTimeout((()=>{t(!0)}),e)}))}));const C=128,D=256;class H extends a{constructor(e,t,s,i){super(e),this.texture=t,this.animate=s,this.single_texture_width=i,this.to_draw_frame=0,this.animate||(this.to_draw_frame=Math.floor(Math.random()*(this.texture.width/this.single_texture_width))*this.single_texture_width)}draw(e){this.animate&&(this.to_draw_frame+=.1,this.to_draw_frame>this.texture.width/this.single_texture_width&&(this.to_draw_frame=0)),e.beginPath(),e.drawImage(this.texture,this.animate?Math.floor(this.to_draw_frame)*this.single_texture_width:this.to_draw_frame,0,this.single_texture_width,this.texture.height,this.screen_pos.x-this.single_texture_width/2,this.screen_pos.y-this.texture.height/2,this.single_texture_width,this.texture.height),e.stroke()}}class F extends H{constructor(e,t,s){super(e,t,!1,s),this.capacity=Math.floor(3*Math.random())+5}spawn_person(){let e=new J({x:this.space_pos.x,y:this.space_pos.y-8,z:this.space_pos.z},o.person_walking,this.space_pos);e.parent=this.parent,this.parent.scene_children[2].push(e),this.capacity-=1}spawn_check(){if(0==this.capacity)return 0;if(0==t.space_pos.y&&i(t.space_pos,this.space_pos)<80){let e=!1;for(let t of this.parent.scene_children[2])t instanceof J&&(e=!0);e||this.spawn_person()}}draw(e){this.spawn_check(),e.beginPath(),e.drawImage(this.texture,this.to_draw_frame,0,this.single_texture_width,this.texture.height,this.screen_pos.x-8,this.screen_pos.y-8,this.single_texture_width,this.texture.height),e.stroke()}}class G extends H{constructor(e,t,s){super(e,t,!0,s),this.animation_frame=Math.floor(Math.random()*this.texture.width)}draw(e){this.animation_frame+=.25,this.animation_frame+this.single_texture_width>this.texture.width&&(this.animation_frame=0),e.beginPath(),e.drawImage(this.texture,this.animation_frame,0,this.single_texture_width,this.texture.height,this.screen_pos.x-8,this.screen_pos.y-8,this.single_texture_width,this.texture.height),e.stroke()}}class J extends h{constructor(e,s,i){super(e,new Image,new Image,new Image),this.texture=s,this.name="PERSON",this.mind=new n(this,"reach"),this.mind.aim=!1,this.mind.max_speed=1,this.mind.desired_point=t.space_pos,this.animation_frame=0,this.bunker_pos=i}check(){let e=i(t.space_pos,this.bunker_pos);0!=t.space_pos.y||e>80?(this.mind.task="dummy",this.texture=o.person_waiting):"dummy"==this.mind.task&&e<=80&&(this.mind.task="reach",this.mind.desired_point=t.space_pos,this.texture=o.person_walking),this.animation_frame+=.15,this.animation_frame>this.texture.width/10&&(this.animation_frame=0),this.space_pos.x==t.space_pos.x&&this.space_pos.y==t.space_pos.y&&this.space_pos.z==t.space_pos.z&&(this.kill(2),T++,O("survivor rescued",30))}draw(e){this.mind.think(),this.check(),this.translate_self(),e.beginPath(),e.drawImage(this.texture,10*Math.floor(this.animation_frame),0,10,8,this.screen_pos.x-8,this.screen_pos.y-8,10,8),e.stroke()}}class W extends H{constructor(e,t,s){super(e,new Image,!1,0),this.color=s,this.vertezies=t}draw(e){let t=[this.translate_pos(this.vertezies[0],this.parent.renderer_xpos),this.translate_pos(this.vertezies[1],this.parent.renderer_xpos),this.translate_pos(this.vertezies[2],this.parent.renderer_xpos),this.translate_pos(this.vertezies[3],this.parent.renderer_xpos)];e.beginPath(),e.fillStyle=this.color,e.moveTo(t[0].x,t[0].y),e.lineTo(t[2].x,t[2].y),e.lineTo(t[3].x,t[3].y),e.lineTo(t[1].x,t[1].y),e.fill()}}class X extends H{constructor(e,t,s){super(e,new Image,!1,0),this.parent=s,this.color=t}draw(e){this.translate_self(),this.vertezies=[this.translate_pos({x:this.space_pos.x+C,y:0,z:this.space_pos.z-D},this.parent.renderer_xpos),this.translate_pos({x:this.space_pos.x+C,y:0,z:this.space_pos.z+D},this.parent.renderer_xpos),this.translate_pos({x:this.space_pos.x+8*C,y:0,z:this.space_pos.z-D},this.parent.renderer_xpos),this.translate_pos({x:this.space_pos.x+8*C,y:0,z:this.space_pos.z+D},this.parent.renderer_xpos)],e.beginPath(),e.moveTo(this.vertezies[0].x,this.vertezies[0].y),e.lineTo(this.vertezies[2].x,this.vertezies[2].y),e.lineTo(this.vertezies[3].x,this.vertezies[3].y),e.lineTo(this.vertezies[1].x,this.vertezies[1].y),e.fillStyle=this.color,e.fill()}}class U extends a{constructor(e,t,s){super(e),this.children=new Array,this.parent=t,this.children=s();for(let e of this.children)e instanceof W&&(e.vertezies[0].x+=this.space_pos.x,e.vertezies[1].x+=this.space_pos.x,e.vertezies[2].x+=this.space_pos.x,e.vertezies[3].x+=this.space_pos.x),e.space_pos.x+=this.space_pos.x,e instanceof F&&e.spawn_person()}draw(e){for(let t of this.children)t.translate_self(),t.draw(e)}}const V=[[o.enemy_bend_green,o.enemy_green],[o.enemy_bend_yellow,o.enemy_yellow],[o.enemy_bend_purple,o.enemy_purple],[o.enemy_bend_pink,o.enemy_pink],[o.enemy_bend_red,o.enemy_red],[o.enemy_bend_violet,o.enemy_violet]],Z=1,$=new h({x:96,y:8,z:-30},o.player,o.player_shadow,o.player_projectile,"PLAYER"),Q=document.getElementById("game-field"),ee=new class{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.scene_children=[[],[],[]],this.renderer_xpos=0,this.let_render=!1,this.draw_road=!0,this.road_end=!1,this.killer_positions=new Array,this.total_loops=0}add_projectile(e){e.parent=this,e.translate_self(),this.scene_children[2].push(e)}add_entity(...e){let t=new Array;for(let e of this.scene_children[1])t.push(e.space_pos.y);for(let t of e)t.parent=this,t.translate_self(),this.scene_children[1].push(t)}move_rendering_space(e){this.renderer_xpos+=e;for(const e of this.scene_children[1])e.translate_self()}set_background(e,t){if(this.background_color=e,this.background_generation=t,0==this.scene_children[0].length)for(let e=0;e<5;e++){let t=new U({x:(e-1)*C,y:0,z:0},this,this.background_generation);t.parent=this,this.scene_children[0].push(t)}}find(e){for(let t of this.scene_children[1])if(t.name==e)return t;return null}new_background_chunk(){let e=new U({x:this.scene_children[0][this.scene_children[0].length-1].space_pos.x+C,y:0,z:100},this,this.background_generation);this.road_end&&(this.road_end=!1),this.scene_children[0].push(e)}remove_unseen(){for(let e=0;e<this.scene_children.length;e++)for(let t=0;t<this.scene_children[e].length;t++)if(this.scene_children[e][t].space_pos.x+C<this.renderer_xpos){if(0==e&&this.scene_children[e][t]instanceof X)continue;this.scene_children[e].splice(t,1),0==e&&this.new_background_chunk()}for(let e=0;e<this.killer_positions.length;e++)this.killer_positions[e].x<this.renderer_xpos&&this.killer_positions.splice(e,1)}draw_scene(){for(let e of this.scene_children[0])e.space_pos.x<this.renderer_xpos+1.5*this.canvas.width&&e.draw(this.ctx);for(let e of this.scene_children[1])e.space_pos.x>this.renderer_xpos&&e.space_pos.x<this.renderer_xpos+1.5*this.canvas.width&&e.draw_shadow(this.ctx);for(let e of this.scene_children[1])e.space_pos.x>this.renderer_xpos&&e.space_pos.x<this.renderer_xpos+1.5*this.canvas.width&&e.draw(this.ctx);for(let e of this.scene_children[2])e.space_pos.x>this.renderer_xpos&&e.space_pos.x<this.renderer_xpos+1.5*this.canvas.width&&e.draw(this.ctx)}stop_render(){this.let_render=!1}render(e){return t=this,s=void 0,a=function*(){let t;this.let_render=!0;const s=()=>{this.total_loops++,this.remove_unseen();for(let e of this.scene_children[2])e instanceof p&&e.move();e(),this.ctx.beginPath(),this.ctx.fillStyle=this.background_color,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.stroke(),this.draw_scene(),this.let_render&&window.requestAnimationFrame(s)};t=window.requestAnimationFrame(s)},new((i=void 0)||(i=Promise))((function(e,n){function o(e){try{h(a.next(e))}catch(e){n(e)}}function r(e){try{h(a.throw(e))}catch(e){n(e)}}function h(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(o,r)}h((a=a.apply(t,s||[])).next())}));var t,s,i,a}}(Q);var te,se,ie,ae;te=void 0,se=void 0,ae=function*(){(()=>{const e=navigator.userAgent;if(/android|iphone|kindle|ipad/i.test(e)){k.isMobile=!0,window.addEventListener("deviceorientation",b),window.addEventListener("click",(()=>{k.clicked=!0}));try{document.getElementById("start-screen").innerHTML='<h1>PANTHER</h1><p style="margin-bottom:30%">by Oskar Marciniak<br/>use horizontal mode for valid experience<br/>click anywhere to continue</p>'}catch(e){console.log("error")}}})(),t=$,ee.explosion_texture=o.explosion,ee.add_entity($)},new((ie=void 0)||(ie=Promise))((function(e,t){function s(e){try{a(ae.next(e))}catch(e){t(e)}}function i(e){try{a(ae.throw(e))}catch(e){t(e)}}function a(t){var a;t.done?e(t.value):(a=t.value,a instanceof ie?a:new ie((function(e){e(a)}))).then(s,i)}a((ae=ae.apply(te,se||[])).next())}))})();